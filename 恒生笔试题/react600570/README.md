### 长列表无限滚动示例  

时间问题，目前还未达到性能要求，已有思路  

### 方案一（自己试了一下，感觉不太实际）：

    1. 每一页数据都分别保存在一个数组中，然后将每一页的需要渲染的dom封装成一个组件，称为cell

    2. 滚动加载的时候不断在后面追加cell,让浏览器每次只渲染最新追加的数据  

### 方案二（试了一下，感觉可行）：  

整体思路：通过定位将列表项展示在可视区域。滚动时，列表项dom不增加，增加包裹div的高度，动态调整列表项定位的top值来达到无限加载的目的 。这个实现方案让我想到一个场景，阿里有严格的分层等级,比如p7、p6、外包分的很开，我觉得这个场景非常贴切。p7（listWrapper）领着p6(list),p6带着几个外包(cell)做项目，外包数量固定。项目开始...，p7啥也不干，专门负责监视p6（监听scroll事件），p6负责安排外包开发项目，慢慢的一个又一个的项目完成了，外包还在不断的在各个项目滚动，p6这边完成东西越积越多（height随着滚动变高），也实时反反应到p7这边（滚动条）。如果p7要来看看之前做的项目的话（往回滚动），只需要外包找到对应的项目（找准数据回填）展示出来即可。当然有很多环节需要优化，比如p7一直催项目完成情况，但是p6可以选择隔一段时间上报工作情况（节流）。演示组件 scrollList  

1. 第一步：给定两个div,实现无限滚动，外层div命名为listWrapper,内层div命名为list  

2. 第二步：往子div中加列表项（固定项数），命名为cell,滚动的时候不断调整cell的定位top值  

### 其他方案  

今天看到了网上的一篇文章，说无限滚动有4种（包括直接concat老数据这种一共6种）实现方案，[React 之无限滚动](https://zhuanlan.zhihu.com/p/32075662)。看了一下，稍作总结  

1. 不做任何处理，有多少展示多少。取到数据直接concat，dom和数据行对应  
2. 懒加载。固定cell,外层包一个div,计算当前已有数据条数来计算div高度和cell的相对位置  
3. 用于解决每个cell高度不一致的情况  
4. mobile转屏情况
5. cellg高度可变，并且mobile转屏  


#### 需要解决的问题列表：  
1. 无限滚动效果,已完成  
2. 往回滚动能查看已加载的信息,已完成  
3. 数据抽离,列表数据通过参数传入,已完成  
4. 滚动节流，控制响应频率  
5. 滚动可视区域高度自定义，可通过参数传入  
6. 滚动条距离底部多高开始接收数据，可通过参数传入  
7. 无缝滚动，分页数据交接处做到平滑过渡  

#### 开发过程遇到的问题汇总  
1. 开始接收数据到接收到数据这段时间，显示loading  
2. 键盘按上下键会丢失选中，dom节点和数据未匹配上  
3. 分页交接点的时候，滚动不流畅，给人感觉是跳到下一页而不是滚到下一页的    
4. 键盘向下按下一条时分页问题   

针对以上问题解决方案汇总    
1. loading GIF图固定在所有cell底部，当分页数据未返回时展示loading，否则隐藏  
2. 通过判断当前cell dom的index和当前是第几页，来判断是否选中当前行  
3. dom结构分成三分，每一份分别渲染一页数据，当中间那页的dom滚动到低时，最上面的dom 定位到最底部，紧挨着原底部的dom，这样即可实现无缝滚动，不会出现跳页的不好体验  
4. 将下一页和上一页渲染dom分别封装成方法，按下一条时判断是否到了下一页，如果是则调用渲染下一页的方法  



