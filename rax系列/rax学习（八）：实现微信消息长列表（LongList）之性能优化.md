仓库地址：[rax-longlist](https://github.com/XingGuoZM/native-module/tree/master/rax-longlist) 
### 介绍一下  
前一节我们可以看到，数据量一上来就出现了很多问题。本节我们就来讲讲这些bug的解决办法。首先我们要知道为什么会出现这个问题，我们的长列表在大量数据（上千条，这个量级并不多）的情况下会出现拖动卡顿甚至拖不动，控制台也报错了。我们可以分析一下出现问题的原因，控制台报的错误如下

![](https://img2020.cnblogs.com/blog/1347757/202008/1347757-20200818233701126-388781468.png)

- 第一个问题分析  
  控制台报错说有重复的key，为什么会有重复的key值呢，我们的mock.js中不是已经传了page了吗，每次返回的数据的id应该都是不一样的才对呀。出现id重复的情况只有一种，那就是传入的page值是一样的，也就是说我们的监听滚动的事件跟新太频繁了，导致page来不及变化，这就是我们本地mock的第一个问题，当然请求接口也会出问题的，频繁请求接口很容易就把服务器给弄宕机了。所以第一个问题是 放缓请求数据的频率，我们可以使用节流或者防抖来实现。

- 第二问题分析  
  这个问题相对比较棘手一点，数据量多到一定程度，列表会非常卡顿甚至拖不动。这个问题的原因也非常简单，因为我们每次请求到下一页的数据之后都是直接push到当前数组中的，然后又对这个数组进行map成dom节点，最后进行更新页面。这就会导致一个问题，数据越来越多，每次循环所要花费的时间也越来越多。比如我们第一页有10条数据，我们只需遍历10条数据，然后map也是10条数据，但是当请求到第100页的时候，数据达到了1000条，遍历1000条数据这是非常耗时的，同时它也非常耗内存的，1000个div节点，能流畅拖动才怪呢！pc浏览器中测试都拖不动，更别说在手机app上了。弄清楚了卡顿的原因，我们可以来想想解决方案了。其实我们并不需要这么多节点，小小的手机屏幕可视区域非常小，我们只需要保证屏幕可视区域能够正常展示即可，因此我们可以把dom节点简化20个（我们的数据是一页10条），然后滚动的时候不断的进行替换，只要我们保证上下滚动的时候需要展示的数据能与当前页对应上就行。


### 需求  
- 流畅拖动数据，万条数据不报错不卡顿

### 解决方案  

### 代码展示  

### 效果展示  

### 参考  

- [使用react 实现一个无限滚动列表](https://www.jianshu.com/p/d54d65d20b1c)  